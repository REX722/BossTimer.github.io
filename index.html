<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Boss 重生倒數</title>
  <style>
    table { border-collapse: collapse; width:100% }
    th,td{ border:1px solid #ccc; padding:4px 8px; text-align:center }
    .soon{ color:red }
  </style>
</head>
<body>
  <h1>📋 Boss 重生倒數</h1>
  <table>
    <thead>
      <tr><th>頻道</th><th>記錄</th><th>倒數45分</th><th>倒數1h8m</th></tr>
    </thead>
    <tbody id="tbl"></tbody>
  </table>
  <script>
    async function update() {
      const resp = await fetch('records.json');
      const data = await resp.json();
      const now = Date.now();
      const tbody = document.getElementById('tbl');
      tbody.innerHTML = '';
      for (const [ch, lst] of Object.entries(data)) {
        for (const rec of lst) {
          const ts = new Date(rec.ts).getTime();
          const rem45 = Math.max(0, 45*60*1000 - (now - ts));
          const rem68 = Math.max(0, (60+8)*60*1000 - (now - ts));
          const fmt = ms => {
            if (ms<=0) return '00:00';
            const m = Math.floor(ms/60000), s = Math.floor((ms%60000)/1000);
            return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
          };
          const tr = document.createElement('tr');
          if (rem45 <= 5*60*1000 && rem45>0) tr.classList.add('soon');
          tr.innerHTML = `
            <td>${ch}</td>
            <td>${new Date(rec.ts).toLocaleString()}</td>
            <td>${fmt(rem45)}</td>
            <td>${fmt(rem68)}</td>
          `;
          tbody.appendChild(tr);
        }
      }
    }
    setInterval(update, 1000);
    update();
  </script>
</body>
</html>
